---
title: canvas中的图片跨域问题
date: 2020-11-23 00:43:35
tags:
  - canvas
  - 跨域
---

canvas的图片跨域问题是指，当在canvas中使用和当前网站不同域名的图片资源的时候，如果你想使用canvas的`toDataURL`等转化成实际图片进行处理，比如下载。这时候你会发现跨域的图片的那部分将无法加载出来。

这种事情是非常常见的，因为我们很多情况下并不会把图片资源和网页挂在同一个域名下。当然，你也可以对某些子路径的域名做一层反代规避掉这个问题。如果你没有做这个，那么你应该怎么办呢？

这时候你就需要做两件事：
1. 首先在你存放文件的地方，如果是在腾讯云或者阿里云这种，直接设置图片的跨域头。也就是加上`Access-Control-Allow-Origin: ${ your domain }`的跨域头。当然如果你嫌麻烦，跨域直接把`${ your domain }`这一部分写成*，这样任何网页都可以使用你的图片。

2. 然后在 img 标签上添加一个属性,有两种方法添加

  - 通过js添加，也就是在那个img标签中做如下操作

    ```
    const image = new Image()
    image.crossOrigin = "anonymous"
    image.src = "url" // set a true url
    ```

  - 直接在HTML代码中添加

    ```
    <img src="url" crossorigin="anonymous" />
    ```

但是，以上的解决方法都是在图片的控制权在你的手上的情况下。如果这是一张第三方的图片，你就无法设置他的跨域头来解决问题了。就比如产品希望我在canvas上画上一个微信生成的二维码。我不是马化腾，没有能力让腾讯的工程师给我加一个跨域头。所以这种情况下，也有两个办法：

1. 让后端的同学们帮忙开一个接口，下载那个图片。后端的接口是可以控制的。
2. 通过nginx设置反代来获取那张图片，并且在nginx中加入设置跨域头的配置。
